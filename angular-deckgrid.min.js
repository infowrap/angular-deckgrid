/*! angular-deckgrid (v0.7.8) - Copyright: 2013, André König (andre.koenig@posteo.de) - MIT */
angular.module("akoenig.deckgrid",[]),angular.module("akoenig.deckgrid").directive("deckgrid",["DeckgridDescriptor",function(a){"use strict";return a.create()}]),angular.module("akoenig.deckgrid").factory("DeckgridDescriptor",["$rootScope","Deckgrid",function(a,b){"use strict";function c(){this.restrict="AE",this.scope={model:"=source"},this.$$deckgrid=null,this.template='<div data-ng-repeat="column in columns" class="{{layout.classList}}"><div data-ng-repeat="item in column"></div></div>',this.compile=function(b,c){var d=c.deckgrid,e=c.extraType,f=c.extraIcon,g=c.showLearnIf,h=c.learnText,i=c.isExamples,j=b.find('[data-ng-repeat="column in columns"]'),k=b.find('[data-ng-repeat="item in column"]'),l={"data-bb-wrap-card":"item"},m="",n="",o="";if("card"===d?(i&&(l["data-allow-marketing"]=!0),h&&(n="<div "+(g?'data-ng-if="'+g+'" ':"")+'class="{{layout.classList}}" ><div class="component learn" data-type="'+e+'" data-icon="'+f+'" ><div class="contents"> '+h+"</div></div></div>")):"asset"===d?(a.isDetailPage&&b.attr("data-deckgrid","assets-full"),l={"data-bb-wrap-asset":"item"},n='<div data-ng-if="mother.section.assets.length == 1" class="{{layout.classList}}" ><div class="component learn" data-type="{{mother.section.type}}" data-icon="{{mother.section.type}}" ></div></div>'):"gallery"===d?(l={"data-ng-click":"$event.stopPropagation(); mother.showSlide(item.id);","class":"image loading-spinner","data-unveil-item":"item.asset","data-constrain-width":"270","data-fit":"max","data-has-image":"true"},m='<div class="spinner" data-icon="spinner"></div> <img class="pusher" data-pusher-gif data-constrain-width="270" data-calc-width="{{item.asset.width}}" data-calc-height="{{item.asset.height}}" data-fp-fallback="item.asset.url" /><div data-ng-show="mother.editing" data-icon="delete" data-ng-click="$event.stopPropagation(); mother.removeImage(item.id);" ></div> </div>',o='<div class="{{layout.classList}}" ><div class="image new" data-has-image="false" data-editor="true" data-filepicker-btn data-ng-show="mother.editing" data-process-when="$root.activeWrap.editable" data-store-location="S3" data-mime-types="image/*" data-target-id="mother.asset.id" data-target-parent-id="$root.activeWrap.id" data-target-type="gallery" data-title="Add Images" ></div></div>'):"notification"===d?(l={"data-bb-notification-card":"item","data-dashboard":"true","data-wraps":"mother.wraps","data-groups":"mother.groups"},n="<div "+(g?'data-ng-if="'+g+'" ':"")+'class="{{layout.classList}}" ><div class="component learn" data-type="'+e+'" data-icon="'+f+'" ><div class="contents"> '+h+"</div></div></div>"):"user"===d?(l={"data-bb-user-row":"item","data-user-type":e},n='<div class="{{layout.classList}}" ><div class="component learn" data-type="'+e+'" data-icon="'+f+'" ><div class="contents"> '+h+"</div></div></div>",o='<div class="{{layout.classList}}" ><div class="component new '+e+'" data-bb-share data-ng-click="showOptions($event)" data-target="$root.activeWrap" data-type="'+("followers"===e?"follow":"collaborate")+'" data-target-name="$root.activeWrap.name" data-title="Invite '+_.capitalize(e)+'" ></div></div>'):"member"===d&&(l={"data-bb-user-row":"item","data-user-type":e},o='<div class="{{layout.classList}}" ><div class="component new '+e+'" data-bb-share data-ng-click="showOptions($event)" data-target="mother.group.id" data-type="member" data-target-name="mother.group.name" data-title="Invite Group Members" ></div></div>'),l)for(var p in l)k.attr(p,l[p]);return m&&k.html(m),n&&$(n).insertAfter(j),o&&$(o).insertAfter(j),this.$$link.bind(this)}}return c.prototype.$$destroy=function(){this.$$deckgrid.destroy()},c.prototype.$$link=function(a,c){a.$on("$destroy",this.$$destroy.bind(this)),a.mother=a.$parent,this.$$deckgrid=b.create(a,c[0])},{create:function(){return new c}}}]),angular.module("akoenig.deckgrid").factory("Deckgrid",["$window","$log","$rootScope","$q","$timeout",function(a,b,c,d,e){"use strict";function f(a,b){var c,d=this;this.$$elem=b,this.$$watchers=[],this.$$scope=a,this.$$scope.columns=[],this.$$getLayout().then(function(a){d.$$scope.layout=a,d.$$createColumns(),c=d.$$scope.$watch("model",d.$$onModelChange.bind(d),!0),d.$$watchers.push(c),angular.forEach(d.$$getMediaQueries(),function(a){function b(){a.removeListener(d.$$onMediaQueryChange.bind(d))}a.addListener(d.$$onMediaQueryChange.bind(d)),d.$$watchers.push(b)})})}return f.prototype.$$getMediaQueries=function(){function b(a){try{return a.sheet.cssRules||[]}catch(b){return[]}}function c(a){var b=/\[(data-)?deckgrid[^\]]*\]::before/g,c=0,d="";if(!a.media||angular.isUndefined(a.cssRules))return!1;for(c=a.cssRules.length-1;c>=0;c-=1)if(d=a.cssRules[c].selectorText,angular.isDefined(d)&&d.match(b))return!0;return!1}var d=[],e=document.styleSheets;return angular.forEach(e,function(e){var f=b(e);angular.forEach(f,function(b){c(b)&&d.push(a.matchMedia(b.media.mediaText))})}),d},f.prototype.$$createColumns=function(){var a=this;return this.$$scope.layout?(this.$$scope.columns=[],void angular.forEach(this.$$scope.model,function(b,c){var d=c%a.$$scope.layout.columns|0;a.$$scope.columns[d]||(a.$$scope.columns[d]=[]),a.$$scope.columns[d].push(b)})):b.log("angular-deckgrid: No CSS configuration found (see https://github.com/akoenig/angular-deckgrid#the-grid-configuration)")},f.prototype.$$getLayout=function(){var b,c,f,g=d.defer(),h=this,i=3,j=0,k=function(){b=a.getComputedStyle(h.$$elem,":before").content},l=function(){b=b.replace(/'/g,""),b=b.replace(/"/g,""),b=b.split(" "),2===b.length&&(c={},c.columns=0|b[0],c.classList=b[1].replace(/\./g," ").trim()),f&&e.cancel(f),g.resolve(c)},m=function(){f=e(function(){k(),b?l():i>j&&(j++,m())},300)};return k(),b?l():m(),g.promise},f.prototype.$$onMediaQueryChange=function(){var a=this;this.$$getLayout().then(function(b){if(b&&b.columns!==a.$$scope.layout.columns){a.$$scope.layout=b;var d=function(){a.$$createColumns()},e=c.$$phase;"$apply"===e||"$digest"===e?d():a.$$scope.$apply(d)}})},f.prototype.$$onModelChange=function(a,b){var c=this;a&&(angular.isUndefined(b)?c.$$createColumns():a.length!==b.length?c.$$createColumns():a.length>0&&(angular.isUndefined(c.$$scope.columns)||0===c.$$scope.columns.length)&&c.$$createColumns())},f.prototype.destroy=function(){var a=this.$$watchers.length-1;for(a;a>=0;a-=1)this.$$watchers[a]()},{create:function(a,b){return new f(a,b)}}}]);